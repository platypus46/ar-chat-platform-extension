<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입 테스트 코드</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div id="step1">
        <form id="form_step1">
            {% csrf_token %}
            <label for="username">Username:</label>
            <input type="text" id="username" name="username">
            <button type="button" onclick="validateStep(1)">Next</button>
        </form>
    </div>
    <div id="step2" style="display: none;">
        <form id="form_step2">
            {% csrf_token %}
            <label for="full_name">Full Name:</label>
            <input type="text" id="full_name" name="full_name">
            <button type="button" onclick="validateStep(2)">Next</button>
        </form>
    </div>
    <div id="step3" style="display: none;">
        <form id="form_step3">
            {% csrf_token %}
            <label for="password1">Password:</label>
            <input type="password" id="password1" name="password1">
            <label for="password2">Confirm Password:</label>
            <input type="password" id="password2" name="password2">
            <button type="button" onclick="validateStep(3)">Register</button>
        </form>
    </div>
    <script>
       var registrationData = {};
       function validateStep(step) {
        var formData = new FormData();
        if (step === 1) {
            registrationData.username = $('#username').val();
            formData.append('username', registrationData.username);
        } else if (step === 2) {
            registrationData.full_name = $('#full_name').val();
            formData.append('full_name', registrationData.full_name);
        } else if (step === 3) {
            registrationData.password1 = $('#password1').val();
            registrationData.password2 = $('#password2').val();
            formData.append('password1', registrationData.password1);
            formData.append('password2', registrationData.password2);
        }

        $.ajax({
            type: 'POST',
            url: '/validate_step/' + step + '/',
            data: formData,
            processData: false,
            contentType: false,
            beforeSend: function (xhr) {
                xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
            },
            success: function (response) {
                if (response.status === 'success') {
                    if (step === 3) {
                        finalRegistration();
                    } else {
                        $('#step' + step).hide();
                        $('#step' + (step + 1)).show();
                    }
                } else {

                    alert('Error: ' + response.errors);
                }
            },
            error: function () {
                alert('Error: Something went wrong.');
            }
        });
    }   

    function finalRegistration() {
        $.ajax({
            type: 'POST',
            url: '/register_login/',
            data: {
                'action': 'register',
                'username': registrationData.username,
                'full_name': registrationData.full_name,
                'password1': registrationData.password1,
                'password2': registrationData.password2,
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function (response) {
                if (response.status === 'success') {
                 
                    window.location.href = '/register_login/';
                } else {
                
                    alert('Error: ' + response.errors);
                }
            },
            error: function () {
                alert('에러가 발생함');
            }
        });
    }
    </script>
</body>
</html>

